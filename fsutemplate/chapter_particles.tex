\chapter{Particle Systems}

\section{Particle Systems}
\toi{discuss the fundamental aspects of particle systems}
A Particle system is a system composed of points in space whose behavior is
defined by rules which act on those points. Most commonly used in graphics and
video games to simulate special effects like fire, smoke, water and explosions
particle systems are also used in computational fluid dynamics, astrophysics
and materials science. 
\begin{comment}
\begin{figure}[!htc]
 		%\centering
        % this picture should be wordwrapped i think
		\includegraphics[scale=0.5]{figures/pretty_particles.png}
		\label{fig:logic}
        \caption{ pretty particle system picture }
\end{figure}
\end{comment}



All particle systems share some fundamental properties, first they must be able
to represent points in 1, 2 or 3 dimensional space. For our purpose we will use
3 dimensions, with the location of each particle being denoted with the
coordinates \verb|x|, \verb|y| and \verb|z|. We conceptualize each particle as
an unique individual in the system, usually representing some small piece of a
larger whole. In our case each particle represents some small volume of water,
but for a fire effect the particle serves as an animated paint brush. In both
cases each particle will have some associated properties unique to it, such as
its density in the water simulation, or its color in the fire effect.


A particle system is not useful unless it changes over time, therefore it is
important to have the concept of a \verb|timestep|. The timestep is used to
determine how fast a system changes over time. It is important to distinguish
between simulation time and real-time, one can simulate the formation of a
galaxy over a million years, or the creation of a protien in nanoseconds and
render each as a 30 second movie. We will discuss simulation time in terms of
\verb|updates| to the system, where each update advances the simulation time
one timestep. The creator of the system can determine how many updates to
perform for some unit of real-time. This is usually measured in frames per
second, where a frame is the rendering of a 3D scene to be displayed. A
desirable frames per second (fps) for a video game is 60fps, with 30fps
considered real-time. For reference, movies are displayed at 24fps. 


Each particle has a location and some properties associated with it, and these
can all change over time. The most common way to control how they change is by
calculating the forces exerted on each particle. These forces can be external
to the system, such as gravity or force fields (like wind) or internal, meaning
the particles exert force on each other. When we update the system, we want to
calculate a new location for each particle based on the forces applied to it.
This is done by integrating the force to obtain a velocity and then integrating
the velocity to obtain the new position.
\toi{acceleration, velocity and position equations (Euler)} 
The simplest way of computing this is called Euler's method, which takes the
velocity at the previous timestep, and adds the force multiplied by the
timestep. The new velocity is then multiplied by the timestep and added to the
position at the previous timestep to obtain the new position.

\begin{comment}
\begin{figure}[!htc]
 		\centering
		\includegraphics[scale=0.5]{figures/eulers_method.png}
		\label{fig:logic}
        \caption{ A Particle moving according to forces }
\end{figure}
show a particle's path over time with dotted previous particles. have a reference curve which is the velocity function
we should end up with a streamline where the viewer can see the state at each previous timestep
\end{comment}


Particle systems are especially interesting because simple rules governing the behavior of
each particle can lead to complex behavior of the whole system. 




\section{Introduction to the Framework}

There are many aspects to particle systems which will be common to different
simulations, namely the locations of each particle in some space as well as the
notion of displaying them in some way. In order to create an extensible tool we
designed an object oriented software framework for general particle systems.
The primary motivation for this is to avoid duplicating work when creating
different simulations.


We first define an interface for the user of the particle system to interact
with, the \verb|RTPS| class. This class initializes a particle system with some
initial settings and exposes functions to update and render the particles. It
also allows access to it's internal system object, which has functions for
interacting with the system directly. These functions are general for all
systems, but may be implemented differently by different types of systems. For
example inserting particles to the system, or setting up a "hose" which will
spray particles.


The rendering of particles is handled separately from the simulation so that
different particle systems may take advantage of the available rendering
classes. It is also easy to add a new way of rendering by defining a new
rendering class derived from the \verb|Render| class.


Someone wishing to add a new type of particle system does not have to spend
much energy on infrastructure but can rather focus on implementing the rules
which govern the behavior of their particles, or adding new functionality to
interface with some external projects. It is likely that users will want to
integrate particles into their existing game mechanics, and the framework has
been designed with this in mind.



